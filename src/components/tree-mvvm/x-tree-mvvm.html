<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>xtree.js</title>
    <link rel="stylesheet" href="../../base/xtree.css">
    <link rel="stylesheet" href="../../base/fonts/iconfont.css">
</head>
<body>
<script type="text/javascript" src="../../base/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="x-tree-mvvm.js"></script>


<!--接下来的是odp版的tree-->
<div id="x-tree-root" class="tree-wrap">
    <div id="x-tree-node-temp" class="tree-node-wrap">
        <i id="x-tree-icon-temp" class="iconfont icon-expand"></i>
        <i id="x-tree-checkbox-temp" class="iconfont icon-checked"></i>
        <span id="x-tree-name-temp" class="tree-node-name">name</span>
    </div>
    <div id="x-tree-node-0" class="tree-node-wrap">
        <i id="x-tree-icon-0" class="iconfont icon-expand"></i>
        <i id="x-tree-checkbox-0" class="iconfont icon-checked"></i>
        <span id="x-tree-name-0" class="tree-node-name">name</span>
    </div>

</div>

<script>
    //空文档片段
    //var df = document.createDocumentFragment()
    var dataReference = [
        {id: 1, name: '行政部', nodeId: 0, is_node: true, is_check: false},
        {id: 3, name: '财务部3', nodeId: 1, is_node: true, is_check: false},
        {id: 11, name: '财务部4', nodeId: 3, is_node: true, is_check: false},
        {id: 12, name: '财务部5', nodeId: 11, is_node: true, is_check: false},
        {id: 13, name: '财务部6', nodeId: 12, is_node: true, is_check: false},
        {id: 14, name: '财务部7', nodeId: 13, is_node: true, is_check: false},
        {id: 15, name: '财务部8', nodeId: 14, is_node: true, is_check: false},
        {id: 16, name: '财务部9', nodeId: 15, is_node: true, is_check: false},
        {id: 8, name: '财务部2', nodeId: 3, is_node: true, is_check: false},
        {id: 5, name: '李职员', nodeId: 8, is_node: false, is_check: false},
        {id: 6, name: '孙职员', nodeId: 8, is_node: false, is_check: false},
        {id: 2, name: '张部长', nodeId: 1, is_node: false, is_check: false},
        {id: 4, name: '刘职员', nodeId: 3, is_node: false, is_check: false},
        {id: 9, name: '王经理', nodeId: 0, is_node: false, is_check: false}
    ];
    var domRoot = document.getElementById("x-tree-root");
    var domReference = domRoot;


    observe(dataReference);

    function observe(data) {
        if (!data || typeof data !== 'object') {
            return;
        }
        // 取出所有属性遍历
        Object.keys(data).forEach(function(key) {
            ObjectDefineProperty(data, key, data[key]);
        });
    }

    function ObjectDefineProperty(data, key, val) {
        observe(val); // 监听子属性
        Object.defineProperty(data, key, {
            enumerable: true, // 可枚举
            configurable: false, // 不能再define
            get: function() {
                return val;
            },
            set: function(newVal) {
                console.log(data, key, 'change', val, ' --> ', newVal);
                val = newVal;
                switch (key) {
                    case 'id':
                        console.log('key=id:',data);
                        changeNode(key);
                        break;
                    case 'name':
                        break;
                    case 'nodeId':
                        break;
                    case 'is_node':
                        break;
                    case 'is_check':
                        break;
                    default:
                        break;
                }
            }
        });
    }

    function changeNode(item){
        hideNode(item);
        showNode(item);
        makeNode(item);
    }
    function hideNode(item){
        item.classList.remove('visible');
        item.classList.add('hidden');
    }
    function showNode(item){
        item.classList.remove('hidden');
        item.classList.add('visible');
    }
    function makeNode(base,data) {
        var node = document.createElement("div");
        node.id = 'x-tree-node-' + data.id;
        node.classList.add('tree-node-wrap');
        var icon = makeExpand(data);
        var checkbox = makeCheckbox(data);
        var name = makeName(data);
        node.appendChild(icon);
        node.appendChild(checkbox);
        node.appendChild(name);
        base.appendChild(node);
    }

    function makeExpand(data) {
        var icon = document.createElement("i");
        icon.id = 'x-tree-icon-' + data.id;
        icon.classList.add('iconfont', 'icon-expand');
        return icon;
    }
    function makeCheckbox(data) {
        var checkbox = document.createElement("i");
        checkbox.id = 'x-tree-checkbox-' + data.id;
        checkbox.classList.add('iconfont', 'icon-checked');
        return checkbox;
    }
    function makeName(data) {
        var name = document.createElement("span");
        name.id = 'x-tree-name-' + data.id;
        name.classList.add('tree-node-name');
        var nameStr = document.createTextNode(data.name);
        name.appendChild(nameStr);
        return name;
    }

    function classToggle(ele) {
        if(ele){
            iconToggle(ele);
        }else{
            checkToggle(ele);
        }
    }
    function iconToggle(ele) {
        console.log('iconToggle', ele);
        ele.classList.toggle('icon-shrink');
        ele.classList.toggle('icon-expand');
    }
    function checkToggle(ele) {
        console.log('checkToggle', ele);
        ele.classList.toggle('icon-checked');
        ele.classList.toggle('icon-unchecked');
    }


</script>


<!--接下来的是MVVM的Demo-->
<div id="odp-wrap" class="tree-wrap">
    <input id="odp-input-id" class="odp-input" type="text" placeholder="" value="odp-mvvm-id">
    <div id="odp-output-id" class="odp-output">odp-mvvm</div>

    <input id="odp-input-name" class="odp-input" type="text" placeholder="" value="odp-mvvm-name">
    <div id="odp-output-name" class="odp-output">odp-mvvm</div>

    <input id="odp-input-nodeId" class="odp-input" type="text" placeholder="" value="odp-mvvm-nodeId">
    <div id="odp-output-nodeId" class="odp-output">odp-mvvm</div>
</div>
<script>
    //    Object.defineProperty(obj, prop, descriptor)
    var xTestData = {id:0,name:'test'};
    var idBase = '';
    Object.defineProperty(xTestData, 'id', {
        get: function () {
            console.log(idBase);
        },
        set: function (value) {
            idBase = value;
            document.getElementById('odp-input-id').value = idBase;
            document.getElementById('odp-output-id').innerHTML = idBase;
            console.log(idBase);
        }
    });
    var idInput = document.getElementById('odp-input-id');
    idInput.addEventListener('input', function (e) {
        xTestData.id = e.srcElement.value;
    });


    var nameBase = '';
    Object.defineProperty(xTestData, 'name', {
        get: function () {
            console.log(nameBase);
        },
        set: function (value) {
            nameBase = value;
            document.getElementById('odp-input-name').value = nameBase;
            document.getElementById('odp-output-name').innerHTML = nameBase;
            console.log(nameBase);
        }
    });
    var nameInput = document.getElementById('odp-input-name');
    nameInput.addEventListener('input', function (e) {
        xTestData.name = e.srcElement.value;
    });


    var nodeIdBase = '';
    var nodeIdTemp = '';
    Object.defineProperty(xTestData, 'nodeId', {
        get: function () {
            console.log(nodeIdBase);
        },
        set: function (value) {
            nodeIdBase = value;
            nodeIdTemp = value;
            document.getElementById('odp-input-nodeId').value = nodeIdBase;
            document.getElementById('odp-output-nodeId').innerHTML = nodeIdBase;
            console.log(nodeIdBase);
        }
    });
    var nodeIdInput = document.getElementById('odp-input-nodeId');
    nodeIdInput.addEventListener('click', function (e) {
        nodeIdTemp += 1;
        xTestData.nodeId = nodeIdTemp;
    });
</script>


<!--接下来的是tree-->
<div class="tree-wrap">
    <!--    <input class="test_tree1" placeholder="">-->
    <div class="test_tree1"></div>
</div>
<script>
    var testTree1 = xTreeClosure({
        dom: $('.test_tree1'),
        only_leaf: false,
        node_merge: false,
        is_multi: true,
        is_trigger: false,
        has_search: false,
        expand: 6,
        data: [
            {id: 1, name: '行政部', nodeId: 0, is_node: true, is_check: false},
            {id: 3, name: '财务部3', nodeId: 1, is_node: true, is_check: false},
            {id: 11, name: '财务部4', nodeId: 3, is_node: true, is_check: false},
            {id: 12, name: '财务部5', nodeId: 11, is_node: true, is_check: false},
            {id: 13, name: '财务部6', nodeId: 12, is_node: true, is_check: false},
            {id: 14, name: '财务部7', nodeId: 13, is_node: true, is_check: false},
            {id: 15, name: '财务部8', nodeId: 14, is_node: true, is_check: false},
            {id: 16, name: '财务部9', nodeId: 15, is_node: true, is_check: false},
            {id: 8, name: '财务部2', nodeId: 3, is_node: true, is_check: false},
            {id: 5, name: '李职员', nodeId: 8, is_node: false, is_check: false},
            {id: 6, name: '孙职员', nodeId: 8, is_node: false, is_check: false},
            {id: 2, name: '张部长', nodeId: 1, is_node: false, is_check: false},
            {id: 4, name: '刘职员', nodeId: 3, is_node: false, is_check: false},
            {id: 1, name: '王经理', nodeId: 0, is_node: false, is_check: false}
        ],
        onInit: function () {
            console.log('init');
        },
        onOpen: function () {
            console.log('open');
        },
        onBeforeOpen: function () {
            console.log('beforeopen');
        },
        onClose: function (hasChange) {
            console.log('close');
            console.log(testTree1.getId());
        },
        onCheck: function (item, dom, childrenItem) {
            console.log('check: ', this);
            console.log(testTree1.getName());
            console.log(testTree1.getId());
            console.log(testTree1.getItem());
        },
        onCancel: function (item, dom, childrenItem) {
            console.log('cancel: ', this);
        }
    });
</script>


</body>
</html>