<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>xtree.js</title>
    <link rel="stylesheet" href="src/css/xtree.css">
    <link rel="stylesheet" href="src/lib/fonts/iconfont.css">
</head>
<body>
<script type="text/javascript" src="src/lib/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="src/js/x-tree-closure.js"></script>
<div class="tree-wrap">
    <input type="number" data-bind-123="name" />
</div>

<script>
    function DataBinder( object_id ) {
        // Use a jQuery object as simple PubSub
        var pubSub = jQuery({});

        // We expect a `data` element specifying the binding
        // in the form: data-bind-<object_id>="<property_name>"
        var data_attr = "bind-" + object_id,
            message = object_id + ":change";

        // Listen to change events on elements with the data-binding attribute and proxy
        // them to the PubSub, so that the change is "broadcasted" to all connected objects
        jQuery( document ).on( "change", "[data-" + data_attr + "]", function( evt ) {
            var $input = jQuery( this );

            pubSub.trigger( message, [ $input.data( data_attr ), $input.val() ] );
        });

        // PubSub propagates changes to all bound elements, setting value of
        // input tags or HTML content of other tags
        pubSub.on( message, function( evt, prop_name, new_val ) {
            jQuery( "[data-" + data_attr + "=" + prop_name + "]" ).each( function() {
                var $bound = jQuery( this );

                if ( $bound.is("input, textarea, select") ) {
                    $bound.val( new_val );
                } else {
                    $bound.html( new_val );
                }
            });
        });

        return pubSub;
    }

    function User( uid ) {
        var binder = new DataBinder( uid ),

            user = {
                attributes: {},

                // The attribute setter publish changes using the DataBinder PubSub
                set: function( attr_name, val ) {
                    this.attributes[ attr_name ] = val;
                    binder.trigger( uid + ":change", [ attr_name, val, this ] );
                },

                get: function( attr_name ) {
                    return this.attributes[ attr_name ];
                },

                _binder: binder
            };

        // Subscribe to the PubSub
        binder.on( uid + ":change", function( evt, attr_name, new_val, initiator ) {
            if ( initiator !== user ) {
                user.set( attr_name, new_val );
            }
        });

        return user;
    }
    // javascript
    var user = new User( 123 );
    user.set( "name", "Wolfgang" );

</script>


<div class="tree-wrap">
    <!--    <input class="test_tree1" placeholder="">-->
    <div class="test_tree1"></div>
</div>
<script>
    var testTree1 = xTreeClosure({
        dom: $('.test_tree1'),
        only_leaf: false,
        node_merge: false,
        is_multi: true,
        is_trigger: false,
        has_search: false,
        expand: 6,
        data: [
            {id: 1, name: '行政部', nodeId: 0, is_node: true, is_check: false},
            {id: 3, name: '财务部3', nodeId: 1, is_node: true, is_check: false},
            {id: 11, name: '财务部4', nodeId: 3, is_node: true, is_check: false},
            {id: 12, name: '财务部5', nodeId: 11, is_node: true, is_check: false},
            {id: 13, name: '财务部6', nodeId: 12, is_node: true, is_check: false},
            {id: 14, name: '财务部7', nodeId: 13, is_node: true, is_check: false},
            {id: 15, name: '财务部8', nodeId: 14, is_node: true, is_check: false},
            {id: 16, name: '财务部9', nodeId: 15, is_node: true, is_check: false},
            {id: 8, name: '财务部2', nodeId: 3, is_node: true, is_check: false},
            {id: 5, name: '李职员', nodeId: 8, is_node: false, is_check: false},
            {id: 6, name: '孙职员', nodeId: 8, is_node: false, is_check: false},
            {id: 2, name: '张部长', nodeId: 1, is_node: false, is_check: false},
            {id: 4, name: '刘职员', nodeId: 3, is_node: false, is_check: false},
            {id: 1, name: '王经理', nodeId: 0, is_node: false, is_check: false}
        ],
        //        choose:{
        //            nodeId:[1],
        //            id:[1]
        //        },

        onInit: function () {
            console.log('init');
        },
        onOpen: function () {
            console.log('open');
        },
        onBeforeOpen: function () {
            console.log('beforeopen');
        },
        onClose: function (hasChange) {
            console.log('close');
            console.log(testTree1.getId());
        },
        onCheck: function (item, dom, childrenItem) {
            console.log('check: ', this );
            console.log(testTree1.getName());
            console.log(testTree1.getId());
            console.log(testTree1.getItem());
//            console.log(this);
//            console.log(this.getId());
//            console.log(testTree1);
//            应该是  this.getId()比较规范  还是 testTree1.getId()比较规范   this可以做到 只暴漏该暴漏的方法
        },
        onCancel: function (item, dom, childrenItem) {
            console.log('cancel: ', this );
        }
    });
</script>


</body>
</html>